# üîß –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –¥–µ–±–∞–≥–∞ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

–í–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
```
[2025-07-12 04:03:12] production.ERROR: –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ {"document_id":29,"error":"–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ thread –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫. Thread –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ run."}
```

## üõ†Ô∏è –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 1. üöÄ `debug:full-generation` - –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ª–æ–≥–∏–∫—É `StartFullGenerateDocument` job —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:full-generation {document_id}
```

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
- –°–æ—Å—Ç–æ—è–Ω–∏–µ thread –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ run —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏
- –ü–æ–ø—ã—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ thread
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ API –≤—ã–∑–æ–≤–∞
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ run (—Å—Ç–∞—Ç—É—Å, —Ç–æ–∫–µ–Ω—ã, –æ—à–∏–±–∫–∏)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–∂–¥—É `hasActiveRuns()` –∏ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π

**–ü—Ä–∏–º–µ—Ä:**
```bash
php artisan debug:full-generation 29
```

### 2. ‚ö° `debug:single-subtopic` - –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ thread –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:single-subtopic {document_id} [--create-new-thread]
```

**–û–ø—Ü–∏–∏:**
- `--create-new-thread` - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π thread –¥–ª—è —Ç–µ—Å—Ç–∞ (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ –ë–î)

**–ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:**
- –°–æ—Å—Ç–æ—è–Ω–∏–µ thread –¥–æ –∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
- –¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è API –≤—ã–∑–æ–≤–æ–≤
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–Ω—ã—Ö run
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ `hasActiveRuns()` —Å —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π thread –¥–æ–∫—É–º–µ–Ω—Ç–∞
php artisan debug:single-subtopic 29

# –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π thread –¥–ª—è —Ç–µ—Å—Ç–∞
php artisan debug:single-subtopic 29 --create-new-thread
```

### 3. üìä `debug:thread-monitor` - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:thread-monitor {thread_id} [--interval=5] [--duration=60]
```

**–û–ø—Ü–∏–∏:**
- `--interval=5` - –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `--duration=60` - –û–±—â–µ–µ –≤—Ä–µ–º—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60)

**–ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö run –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö run —Å –∏—Ö —Å—Ç–∞—Ç—É—Å–∞–º–∏
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ thread
- –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ thread –Ω–∞ 2 –º–∏–Ω—É—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
php artisan debug:thread-monitor thread_abc123 --interval=10 --duration=120

# –ë—ã—Å—Ç—Ä—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
php artisan debug:thread-monitor thread_abc123 --duration=30
```

## üìÑ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª:
```
storage/logs/debug_generation.log
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤:
```json
{
  "step": 1,
  "timestamp": "2025-07-12 04:03:12.543",
  "memory_usage": 12345678,
  "memory_peak": 12345678,
  "thread_id": "thread_abc123",
  "context": "–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è",
  "total_runs": 5,
  "active_runs": 1,
  "active_runs_details": [
    {
      "id": "run_xyz789",
      "status": "in_progress",
      "created_at": 1641234567
    }
  ],
  "all_runs": [...]
}
```

## üîç –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–µ–±–∞–≥–∞

### –®–∞–≥ 1: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ thread –¥–æ–∫—É–º–µ–Ω—Ç–∞
php artisan debug:single-subtopic 29

# –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ run, –º–æ–Ω–∏—Ç–æ—Ä–∏–º –∏—Ö
php artisan debug:thread-monitor thread_abc123 --duration=120
```

### –®–∞–≥ 2: –ü–æ–ª–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
php artisan debug:full-generation 29
```

### –®–∞–≥ 3: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
```bash
# –°–º–æ—Ç—Ä–∏–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏
tail -f storage/logs/debug_generation.log

# –ò–ª–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ thread_id
grep "thread_abc123" storage/logs/debug_generation.log
```

## üéØ –ß—Ç–æ –∏—Å–∫–∞—Ç—å –≤ –ª–æ–≥–∞—Ö

### 1. –ê–∫—Ç–∏–≤–Ω—ã–µ run, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è
```json
{
  "message": "–ù–∞–π–¥–µ–Ω –∞–∫—Ç–∏–≤–Ω—ã–π run –≤ thread",
  "thread_id": "thread_abc123",
  "run_id": "run_xyz789",
  "status": "in_progress"
}
```

### 2. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö run
```json
{
  "has_active_via_method": true,
  "manual_check_has_active": false,
  "method_matches_manual": false
}
```

### 3. –î–æ–ª–≥–∏–µ API –≤—ã–∑–æ–≤—ã
```json
{
  "api_call_time": "15.234s",
  "timestamp_before_call": "2025-07-12 04:03:12.100",
  "timestamp_after_call": "2025-07-12 04:03:27.334"
}
```

### 4. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—à–∏–±–∫–∏
```json
{
  "error": "Can't add messages to thread_abc123 while a run run_xyz789 is active",
  "is_active_run_error": true,
  "attempt": 3
}
```

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã

1. **–ó–∞–≤–∏—Å—à–∏–π run** - run –æ—Å—Ç–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `in_progress` —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
2. **–ó–∞–¥–µ—Ä–∂–∫–∞ OpenAI API** - —Å—Ç–∞—Ç—É—Å run –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **Race condition** - –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–∫—Ç–∏–≤–Ω—ã—Ö run –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
4. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é** - –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å OpenAI API

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é

1. **–£–≤–µ–ª–∏—á–∏—Ç—å timeout** –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è run
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É** —Å—Ç–∞—Ç—É—Å–∞ run –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
3. **–£–ª—É—á—à–∏—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
4. **–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–º–µ–Ω—É** –∑–∞–≤–∏—Å—à–∏—Ö run

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `debug:single-subtopic` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –°–æ–±–µ—Ä–∏—Ç–µ –ª–æ–≥–∏ –∏–∑ `storage/logs/debug_generation.log`
3. –£–∫–∞–∂–∏—Ç–µ `thread_id` –∏ –≤—Ä–µ–º—è –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
4. –ü—Ä–∏–ª–æ–∂–∏—Ç–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –ª–æ–≥–æ–≤

## üîÑ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

### 4. üîÑ `debug:parallel-workers` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–∏–º—É–ª–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è race conditions –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ —Å –æ–¥–Ω–∏–º thread.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:parallel-workers {document_id} [--workers=3] [--duration=60] [--delay=2]
```

**–û–ø—Ü–∏–∏:**
- `--workers=3` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- `--duration=60` - –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 60)
- `--delay=2` - –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2)

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –≤ thread
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ run
- Race conditions –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 3 –≤–æ—Ä–∫–µ—Ä–∞–º–∏
php artisan debug:parallel-workers 29 --workers=3 --duration=30

# –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 5 –≤–æ—Ä–∫–µ—Ä–∞–º–∏
php artisan debug:parallel-workers 29 --workers=5 --duration=60 --delay=1
```

### 5. üí• `debug:stress-test` - –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ thread

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ thread —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:stress-test {document_id} [--workers=5] [--iterations=10] [--no-delay]
```

**–û–ø—Ü–∏–∏:**
- `--workers=5` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–µ—Å—Å-–≤–æ—Ä–∫–µ—Ä–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
- `--iterations=10` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π –Ω–∞ –≤–æ—Ä–∫–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `--no-delay` - –û—Ç–∫–ª—é—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞)

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç:**
- –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —ç–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –±–æ–ª—å—à–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö run
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥ —Å—Ç—Ä–µ—Å—Å–æ–º

**–ü—Ä–∏–º–µ—Ä—ã:**
```bash
# –õ–µ–≥–∫–æ–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
php artisan debug:stress-test 29 --workers=3 --iterations=5

# –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
php artisan debug:stress-test 29 --workers=5 --iterations=10 --no-delay
```

### 6. ü§ñ `debug:worker-simulation` - –°–∏–º—É–ª—è—Ü–∏—è –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ò–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –æ–¥–Ω–æ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ –≤ —Å–æ—Å—Ç–∞–≤–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –û–±—ã—á–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `debug:parallel-workers`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:worker-simulation {document_id} [--worker-id=1] [--thread-id=] [--duration=60] [--delay=2]
```

### 7. üî• `debug:stress-worker` - –°—Ç—Ä–µ—Å—Å-–≤–æ—Ä–∫–µ—Ä

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω—è–µ—Ç –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ —á–∞—Å—Ç—å —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∞. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `debug:stress-test`.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
php artisan debug:stress-worker {document_id} [--worker-id=1] [--thread-id=] [--iterations=10] [--delay=0]
```

## üéØ –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£–º–µ—Ä–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏
php artisan debug:parallel-workers 29 --workers=3 --duration=30 --delay=2
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
php artisan debug:parallel-workers 29 --workers=5 --duration=60 --delay=1
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
php artisan debug:stress-test 29 --workers=5 --iterations=10 --no-delay
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
./test_parallel_scenarios.sh 29
```

## üìà –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:
- **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞ > 95%** - –û—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞ 80-95%** - –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞ < 80%** - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **Active Run Errors** - –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ "run is active"
2. **Race Conditions** - –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏
3. **Timeout Errors** - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è
4. **Connection Errors** - –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ thread
- –£–ª—É—á—à–µ–Ω–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–∞
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–∞—É—Ç–æ–≤
- –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Circuit Breaker

## üõ†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### `test_parallel_scenarios.sh` - –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```bash
./test_parallel_scenarios.sh [document_id]
```

**–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:**
- –£–º–µ—Ä–µ–Ω–Ω–æ–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3 –≤–æ—Ä–∫–µ—Ä–∞, 30—Å)
- –ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –≤–æ—Ä–∫–µ—Ä–æ–≤, 45—Å)
- –õ–µ–≥–∫–æ–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (3 –≤–æ—Ä–∫–µ—Ä–∞, 5 –∏—Ç–µ—Ä–∞—Ü–∏–π)
- –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–µ —Å—Ç—Ä–µ—Å—Å-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 –≤–æ—Ä–∫–µ—Ä–æ–≤, 10 –∏—Ç–µ—Ä–∞—Ü–∏–π)
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤:
```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö run
grep -i "while a run.*is active" storage/logs/debug_generation.log

# –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
grep -i "add_time" storage/logs/debug_generation.log

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤–æ—Ä–∫–µ—Ä–∞–º
grep -i "worker.*completed" storage/logs/debug_generation.log
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω—ã—Ö run –≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
php artisan debug:thread-monitor thread_abc123 --interval=1 --duration=120

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f storage/logs/debug_generation.log | grep -i "error\|success"
```

---

*–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –¥–µ–±–∞–≥–∞ –æ—à–∏–±–∫–∏ "–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ thread –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫"* 