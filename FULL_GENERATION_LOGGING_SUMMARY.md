# üìã –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏:
```
Thread thread_sBBUou34ch8Hf92FODmJe4L6 already has an active run run_tSxf2LOMHPB7icYx1hHLRT8Z
```

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `config/logging.php`
**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ù–æ–≤—ã–π –∫–∞–Ω–∞–ª –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è `full_generation`
- –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É: `storage/logs/full_generation.log`
- –£—Ä–æ–≤–µ–Ω—å: `debug`

### 2. `app/Jobs/StartFullGenerateDocument.php`
**–ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º:**

#### –ù–æ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –∫–ª–∞—Å—Å–∞:
- `private float $startTime` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- `private int $stepCounter = 0` - —Å—á–µ—Ç—á–∏–∫ —à–∞–≥–æ–≤

#### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
- `logDetailedStep()` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- `checkThreadStateDetailed()` - –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

#### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–ª—è:
1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø–∞–º—è—Ç—å, –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ GPT** - —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞, –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
4. **–†–∞–±–æ—Ç—ã —Å Thread** - –ø—Ä–æ–≤–µ—Ä–∫–∞ thread_id, –∞–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è
5. **–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞** - –∞–Ω–∞–ª–∏–∑ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
6. **–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–æ–≤** - –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –∑–∞–ø–∏—Å—å –≤ –ë–î, –ø—Ä–æ–≤–µ—Ä–∫–∞
8. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏—è** - —Å–æ–±—ã—Ç–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 3. `app/Console/Commands/TestFullGenerationWithDetailedLogging.php`
**–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª:**
- –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –ö–æ–º–∞–Ω–¥–∞: `php artisan test:full-generation-detailed {document_id}`

### 4. `DETAILED_LOGGING_README.md`
**–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª:**
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É –∏ –∞–Ω–∞–ª–∏–∑—É –ª–æ–≥–æ–≤
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º

## üîç –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è:
- **–ù–æ–º–µ—Ä —à–∞–≥–∞** (—Å–∫–≤–æ–∑–Ω–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è)
- **–¢–æ—á–Ω–æ–µ –≤—Ä–µ–º—è** —Å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞–º–∏
- **–í—Ä–µ–º—è —Å –Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** (—Ç–µ–∫—É—â–µ–µ –∏ –ø–∏–∫–æ–≤–æ–µ)
- **ID –¥–æ–∫—É–º–µ–Ω—Ç–∞**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è** (thread_id, –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞, –∏ —Ç.–¥.)

### –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–∞ –¥–µ—Ç–∞–ª—å–Ω–æ –ª–æ–≥–≥–∏—Ä—É–µ—Ç—Å—è:
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread** –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
2. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞**
3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è** –≤ thread (—Å –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–º –æ—à–∏–±–æ–∫)
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread** –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
5. **–°–æ–∑–¥–∞–Ω–∏–µ run** (—Å –ø–µ—Ä–µ—Ö–≤–∞—Ç–æ–º –æ—à–∏–±–æ–∫)
6. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è thread** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è run
7. **–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è run**
8. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞**
9. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞**

### –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è Thread –≤–∫–ª—é—á–∞–µ—Ç:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ run
- –ê–∫—Ç–∏–≤–Ω—ã–µ run (queued, in_progress, requires_action)
- –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ run (completed)
- –ù–µ—É–¥–∞—á–Ω—ã–µ run (failed, cancelled, expired)
- –î–µ—Ç–∞–ª–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö run (ID, —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è)
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö run

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- **–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç–µ–∫–∞**
- **–§–∞–π–ª –∏ —Å—Ç—Ä–æ–∫–∞** –≥–¥–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** –¥–æ –æ—à–∏–±–∫–∏
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤**
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç** (thread_id, –ø–æ–¥—Ä–∞–∑–¥–µ–ª, –∏ —Ç.–¥.)

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
php artisan test:full-generation-detailed 29
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
```bash
# –í—Å–µ –ª–æ–≥–∏
tail -f storage/logs/full_generation.log

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
tail -f storage/logs/full_generation.log | grep -i "–æ—à–∏–±–∫–∞\|error"

# –ê–Ω–∞–ª–∏–∑ thread —Å–æ—Å—Ç–æ—è–Ω–∏–π
tail -f storage/logs/full_generation.log | grep -i "thread"
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º:
```bash
# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ run
grep -A 5 -B 5 "active run" storage/logs/full_generation.log

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π
grep "document_id.*29" storage/logs/full_generation.log | grep -E "(–¥–æ–±–∞–≤–ª–µ–Ω–∏–∏|—Å–æ–∑–¥–∞–Ω–∏–∏|–æ–∂–∏–¥–∞–Ω–∏–∏)"
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —ç—Ç–æ–≥–æ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã —Å–º–æ–∂–µ—Ç–µ:

1. **–¢–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å** –≥–¥–µ –∏ –∫–æ–≥–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ run
2. **–ü—Ä–æ—Å–ª–µ–¥–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å thread
3. **–í—ã—è–≤–∏—Ç—å race conditions** –º–µ–∂–¥—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
4. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
5. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏** –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
6. **–ü–æ–Ω—è—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É** –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –µ—ë

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
2. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏** —Å –ø–æ–º–æ—â—å—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
3. **–ù–∞–π–¥–∏—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω** –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –æ—à–∏–±–∫–∏
4. **–ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º—É** –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. **–£–ø—Ä–æ—Å—Ç–∏—Ç–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã

–î–∞–Ω–Ω–æ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ run –≤ OpenAI thread. 