# Панель администратора GPT Пульт

## Доступ к админке

Админка доступна только пользователям с ролью "Администратор" (`role_id = 1`).

### Способы доступа:
1. **Прямой URL**: `/admin` - главная страница админки
2. **Кнопка в интерфейсе**: Для администраторов в шапке сайта появляется кнопка "Админка"

## Основной функционал

### 1. Главная страница (`/admin`)
- **Статистика системы**: общее количество пользователей, документов, готовых документов, документов в процессе генерации
- **Последние пользователи**: список из 5 последних зарегистрированных пользователей
- **Последние документы**: список из 5 последних созданных документов
- **Быстрые действия**: ссылки на управление пользователями и документами

### 2. Управление пользователями (`/admin/users`)

#### Список пользователей (`/admin/users`)
- **Поиск и фильтрация**: по имени, email, ID, роли, статусу
- **Отображение**: таблица с основной информацией, количеством документов/заказов, балансом
- **Действия**: просмотр, редактирование, удаление каждого пользователя
- **Пагинация**: по 20 пользователей на страницу

#### Создание пользователя (`/admin/users/create`)
- **Обязательные поля**: имя, email, пароль, роль
- **Дополнительные поля**: статус, баланс, Telegram ID и username

#### Просмотр пользователя (`/admin/users/{id}`)
- **Основная информация**: все данные пользователя
- **Статистика**: количество документов, заказов, сумма платежей, текущий баланс
- **Telegram информация**: если привязан аккаунт
- **Последние документы**: таблица с документами пользователя

#### Редактирование пользователя (`/admin/users/{id}/edit`)
- **Все поля модели**: кроме системных (created_at, updated_at)
- **Безопасность**: пароль не обязательный при редактировании
- **Дополнительная информация**: показывает системные данные

### 3. Управление документами (`/admin/documents`)

#### Список документов (`/admin/documents`)
- **Поиск и фильтрация**: по названию, ID, статусу, пользователю, типу документа
- **Отображение**: таблица с информацией о документе, пользователе, статусе
- **Действия для каждого документа**:
  - Просмотр
  - Редактирование
  - Изменение статуса (быстро)
  - Перенос к другому пользователю
  - Удаление

#### Просмотр документа (`/admin/documents/{id}`)
- **Основная информация**: все данные документа
- **Связанный пользователь**: с быстрой ссылкой на профиль
- **Содержимое документа**: использует существующий компонент просмотра
- **Быстрые действия**:
  - Открыть как пользователь (в новой вкладке)
  - Изменить статус
  - Перенести к другому пользователю

#### Редактирование документа (`/admin/documents/{id}/edit`)
- **Все поля таблицы documents**: кроме content (контента)
- **JSON редакторы**: для structure и gpt_settings с валидацией
- **Смена владельца**: перенос документа к другому пользователю
- **Предупреждения**: о влиянии изменений на генерацию

## Дополнительные возможности

### Массовые операции
- **Быстрое изменение статуса**: прямо из списка документов
- **Перенос документа**: между пользователями
- **Восстановление документов**: из корзины (soft delete)

### Безопасность
- **Проверка роли**: middleware `admin` на всех роутах
- **Защита от удаления**: 
  - Нельзя удалить самого себя
  - Нельзя удалить пользователя с документами/заказами
- **Валидация данных**: на всех формах

### Интерфейс
- **Responsive дизайн**: работает на всех устройствах
- **Vue 3 + Quasar**: современный интерфейс
- **Уведомления**: об успешных/неудачных операциях
- **Подтверждения**: для критических действий

## Технические детали

### Роуты
```php
// Префикс: /admin
// Middleware: ['auth', 'admin']

GET    /admin                               // Главная
GET    /admin/users                         // Список пользователей  
POST   /admin/users                         // Создать пользователя
GET    /admin/users/create                  // Форма создания
GET    /admin/users/{user}                  // Просмотр пользователя
GET    /admin/users/{user}/edit             // Форма редактирования  
PATCH  /admin/users/{user}                  // Обновить пользователя
DELETE /admin/users/{user}                  // Удалить пользователя

GET    /admin/documents                     // Список документов
GET    /admin/documents/{document}          // Просмотр документа
GET    /admin/documents/{document}/edit     // Форма редактирования
PATCH  /admin/documents/{document}          // Обновить документ
DELETE /admin/documents/{document}          // Удалить документ
PATCH  /admin/documents/{document}/status   // Изменить статус
PATCH  /admin/documents/{document}/transfer // Перенести пользователю
PATCH  /admin/documents/{id}/restore        // Восстановить документ
DELETE /admin/documents/{id}/force-delete   // Удалить окончательно
```

### Контроллеры
- `AdminController` - главная страница и статистика
- `AdminUserController` - управление пользователями (CRUD)
- `AdminDocumentController` - управление документами

### Middleware
- `AdminRole` - проверка роли администратора

### Vue компоненты
```
resources/js/pages/admin/
├── Dashboard.vue                 // Главная админки
├── users/
│   ├── Index.vue                // Список пользователей
│   ├── Create.vue               // Создание пользователя  
│   ├── Show.vue                 // Просмотр пользователя
│   └── Edit.vue                 // Редактирование пользователя
└── documents/
    ├── Index.vue                // Список документов
    ├── Show.vue                 // Просмотр документа
    └── Edit.vue                 // Редактирование документа
```

## Как назначить администратора

### Через команду artisan (рекомендуемый способ)

**Назначить существующего пользователя администратором:**
```bash
php artisan admin:make-user user@example.com
```

**Создать нового администратора:**
```bash
php artisan admin:make-user admin@example.com --create
```

**Посмотреть список всех администраторов:**
```bash
php artisan admin:list
```

**Убрать права администратора:**
```bash
php artisan admin:remove-user user@example.com
```

### Альтернативные способы

**Через SQL запрос:**
```sql
UPDATE users SET role_id = 1 WHERE email = 'admin@example.com';
```

**Через tinker:**
```php
php artisan tinker
$user = User::where('email', 'admin@example.com')->first();
$user->role_id = 1;
$user->save();
``` 