# Telegram Bot Integration

Интеграция Telegram бота для автоматической авторизации в личном кабинете.

## Настройка

### 1. Создание бота в Telegram

1. Найдите @BotFather в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Получите токен бота и username

### 2. Настройка переменных окружения

Добавьте в файл `.env`:

```bash
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_BOT_USERNAME=username_бота_без_@
TELEGRAM_WEBHOOK_URL=https://yourdomain.com/telegram/webhook
```

### 3. Режимы работы

#### Тестовый режим (локальная разработка)

Для локального тестирования используйте long polling:

```bash
php artisan telegram:test
```

Опции:
- `--timeout=300` - таймаут в секундах (по умолчанию 5 минут)

#### Продакшн режим (веб-хуки)

Для продакшена настройте веб-хук:

```bash
# Установить веб-хук
php artisan telegram:webhook set

# Установить веб-хук с кастомным URL
php artisan telegram:webhook set --url=https://yourdomain.com/telegram/webhook

# Удалить веб-хук
php artisan telegram:webhook delete

# Получить информацию о веб-хуке
php artisan telegram:webhook info
```

## Использование

### Связка аккаунта

1. Пользователь заходит в личный кабинет
2. Нажимает кнопку "Связать" в блоке Telegram
3. Переходит в Telegram бот и нажимает "Старт"
4. Аккаунты автоматически связываются
5. Имя пользователя в ЛК обновляется на имя из Telegram

### Вход через Telegram

После связки аккаунта пользователь может:
- Быстро входить в ЛК через инлайн-кнопку в Telegram
- Получать уведомления от бота

### Ограничения

- Один аккаунт ЛК = один аккаунт Telegram
- При попытке связать уже связанный аккаунт - ошибка
- Токены связки действуют 5 минут

## API Endpoints

### Для фронтенда

- `POST /telegram/link` - Генерировать ссылку для связки
- `POST /telegram/unlink` - Отвязать Telegram
- `GET /telegram/status` - Статус связки

### Веб-хук

- `POST /telegram/webhook` - Обработка обновлений от Telegram

### Автоматический вход

- `GET /auto-login/{auth_token}` - Вход по токену

## Безопасность

- Все токены генерируются случайно
- Токены связки имеют ограниченное время действия
- Проверка на дублирование связей
- Логирование всех операций

## Команды бота

- `/start` - Начать работу (с токеном - связка аккаунта)
- `/help` - Справка по командам

